name: updater

on:
  push:
    branches: ['*']
  schedule:
    - cron: '25 5 * * *'

jobs:
  update-ad-list:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout ${{ github.repository }}
        uses: actions/checkout@v4.1.7
      - name: Update merged.hosts ad-list
        env:
          ADDITIONAL_INFO: "! Original licence: https://easylist.to/pages/licence.html"
        run: |
          if [ -d .tmp/ ]; then exit 1; else mkdir .tmp/; fi
          for source in $(cat easy-lists.lst); do curl --silent $source >> .tmp/adblock.unsorted; done
          sort -u .tmp/adblock.unsorted | grep ^\|\|.*\^$ | grep -v \/ > .tmp/adblock.sorted
          echo $ADDITIONAL_INFO > merged.hosts
          sed 's/[\|^]//g' < .tmp/adblock.sorted >> merged.hosts && rm -rf .tmp/
          if [ ! -f merged.hosts ]; then  exit 1; else exit 0; fi
      - name: Commit changes
        run: |
          git config --local user.name "autocommit"
          git config --local user.email "primak.aa@gmail.com"
          git add ./merged.hosts
          git commit -m "updating merged.hosts ad-list."
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}